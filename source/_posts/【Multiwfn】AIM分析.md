---
title: 【Multiwfn】AIM分析
typora-root-url: 【Multiwfn】AIM分析
mathjax: true
date: 2021-03-02 15:28:44
updated:
tags: [AIM, 键级, 电荷, 临界点, 键径, 拓扑分析]
categories: [计算化学, Multiwfn]
description: AIM分析
---

http://bbs.keinsci.com/thread-362-1-1.html



AIM（Atoms in molecular）是由已故的R. F. W. Bader从上世纪70年代开始发展的一套波函数分析理论体系。更严格的称为QTAIM (The quantum theory of atoms In molecules)。

- 主要分析的函数：电子密度、电子密度梯度，电子拉普拉斯函数及Hessian、动能密度、势能密度、能量密度、费米穴、源函数等
- 主要研究手段：绘图分析（曲面图、平面图、等值图）、临界点分析、拓扑路径分析、盆积分、分子间面分析等
- 具体概念：AIM电荷、键径、键椭率、维里路径、定域化/离域化指数、AIM键级、AOM键级、eta指数、键金属性、盆偶极矩/四极矩、范德华表面、原子极化率等。如今AIM一词的已经被大为扩展，ELF、模糊原子、信息嫡等概念往往也被算进AIM的范畴。

# 拓扑分析

实空间函数（以三维空间坐标为变量的函数）的拓扑分析主要是需寻找函数的不同类型的临界点，以及获得连接临界点的拓扑路径。

- **电子密度**的拓扑分析是由Bader首先提出的，是AIM理论中的重要组成部分
- 后来拓扑分析的思路又被Silvi、Savin等人用于分析ELF（**电子定域化函数**）

## 相关数学概念

电子密度的梯度模：$$|\nabla \rho(\mathbf{r})|=\sqrt{\left(\frac{\partial \rho(\mathbf{r})}{\partial x}\right)^{2}+\left(\frac{\partial \rho(\mathbf{r})}{\partial y}\right)^{2}+\left(\frac{\partial \rho(\mathbf{r})}{\partial z}\right)^{2}}$$

约化密度梯度（Reduced density gradient）：$$\operatorname{RDG}(\mathbf{r})=\frac{1}{2\left(3 \pi^{2}\right)^{1 / 3}} \frac{|\nabla \rho(\mathbf{r})|}{\rho(\mathbf{r})^{4 / 3}}$$

- 约化密度梯度是电子密度的梯度是电子密度的梯度一种无量纲的形式，通常用在DFT泛函的表达式中，如今也用来展现弱相互作用区域。

电子密度的Hessian矩阵：$$\mathbf{A}\left(\mathbf{r}_{c}\right)=\left(\begin{array}{ccc}
\frac{\partial^{2} \rho}{\partial x^{2}} & \frac{\partial^{2} \rho}{\partial x \partial y} & \frac{\partial^{2} \rho}{\partial x \partial z} \\
\frac{\partial^{2} \rho}{\partial y \partial x} & \frac{\partial^{2} \rho}{\partial y^{2}} & \frac{\partial^{2} \rho}{\partial y \partial z} \\
\frac{\partial^{2} \rho}{\partial z \partial x} & \frac{\partial^{2} \rho}{\partial z \partial y} & \frac{\partial^{2} \rho}{\partial z^{2}}
\end{array}\right)_{\mathbf{r}=\mathbf{r}_{c}}$$

- $$\mathbf{A}$$即临界点，对角元对应于对应方向上的曲率，非对角是混合二阶导数。

将$$\mathbf{A}$$对角化，相当于把笛卡尔坐标x，y，z进行酉变换（相当于进行了旋转）成为x'，y'，z'，得到$$\boldsymbol{\Lambda}=\left(\begin{array}{ccc}
\frac{\partial^{2} \rho}{\partial x^{\prime 2}} & 0 & 0 \\
0 & \frac{\partial^{2} \rho}{\partial \gamma^{\prime 2}} & 0 \\
0 & 0 & \frac{\partial^{2} \rho}{\partial z^{\prime 2}}
\end{array}\right)_{\mathbf{r}^{\prime}=\mathbf{r}_{c}}=\left(\begin{array}{ccc}
\lambda_{1} & 0 & 0 \\
0 & \lambda_{2} & 0 \\
0 & 0 & \lambda_{3}
\end{array}\right)$$

- 三个本征值$$\lambda_{1}$$、$$\lambda_{2}$$、$$\lambda_{3}$$对应于临界点处在x'，y'，z'三个方向电子密度的曲率。

## 临界点

二维中的临界点：

<img src="/image-20210521212251604.png" alt="image-20210521212251604" style="zoom: 50%;" />

**临界点（Critical point，CP）**是实空间函数的梯度的模为0的点，用（m,n）表示。

- m是秩，对于临界点处电子密度非零曲率的数目：
  - 在平衡结构下一般都是3
  - 体系处于不稳定的结构会出现m<3的情况，不考虑。
- $$n=N_p-Nn$$
  - $$N_p$$是Hessian矩阵正本征值的数目
  - $$N_n$$是Hessian矩阵负本征值的数目

所以三维的临界点可以分为四类：

### (3,-3)

Hessian矩阵三个本征值都为负。

- 对应函数的局部极大点，也称为吸引子（attractor）。

- 对于电子密度函数，通常出现在离原子核很近的位置。

  - 对于重原子，(3,-3)临界点与原子核几乎精确重合，因此也称为核临界点（nuclear critical point，NCP）。氢原子由于电子数较少，受周围环境影响明显，因此(3,-3)临界点与氢核位置有一定偏离。
  - 一般情况下(3,-3)临界点与原子核一一对应，数目与原子数目一致。但是有些情况下原子核没有(3,-3)临界点，比如KrH<sup>+</sup>氢核对应的临界点被电子分布弥散的Kr所吞并。也有的(3,-3)临界点出现在原子核以外的位置，比如Li<sub>2</sub>在两个Li之间有(3,-3)临界点。

  > 电子密度在原子核处的尖峰导数不连续，因此严格讲梯度不为0，但实际计算使用的是高斯基函数，因此原子核处的导数是0

- 对于ELF函数，通常出现在共价键区域、孤对电子区域、原子核处。

### (3,-1)

Hessian矩阵两个本征值为负，一个为正。对应函数的二阶鞍点。

如图，箭头代表负梯度（数值最快下降方向），在垂直于键的平面上，此临界点是极大值，在顺着键的方向上，此临界点是极小值：

<img src="/image-20210521205948041.png" alt="image-20210521205948041" style="zoom:50%;" />

- 对于电子密度函数，通常出现在有相互作用的两个原子之间，也被称为键临界点（bond critical point，BCP）。
- 对于ELF函数，位置不甚确定，经常偏离两个相关的(3,-3)的连线很多。

### (3,+1)

Hessian矩阵两个本征值为正，一个为负。对应函数一阶鞍点，如同势能面上的过渡态。

- 对于电子密度函数，通常出现在环体系平面中，如苯环的中心，也被称为环临界点（ring critical point，RCP），表现出位阻效应。在环的平面上，此临界点为电子密度极小值，在垂直于环的方向上为极大值。
- 对于ELF，(3,+1)和(3,+3)通常较少讨论下。

### (3,+3)

Hessian矩阵三个本征值都为正，对应函数的局部极小点。

- 对于电子密度函数，通常出现在笼状体系中，例如C60的中心。也被称为笼临界点（cage critical point，CCP）

### Poincaré-Hopf关系

n(3,-3) – n(3,-1) + n(3,+1) – n(3,+3) =

- 1：孤立体系
- 0：周期性体系

所有临界点找全一定满足此关系，但是满足此条件不代表所有的临界点找全了。

## 拓扑路径

拓扑路径是连接临界点的路径。一般比较关注的是(3,-1)与(3,-3)之间的路径。沿着BCP(3,-1)的Hessian矩阵本征值为正的本征向量方向分别向前和向后出发，顺着梯度方向不断前进就能找到两个(3,-3)，而经过的轨迹就是拓扑路径。（最陡上升法从BCO位置跟踪梯度的最大方向来生成）

- 对于电子密度函数，这样的拓扑路径近似于化学键，因此称为键径（Bond path）。键径可以展示各类原子之间的相互作用的路径，键径的集合称为分子图（molecular graph），是对分子结构的确切描述。
- 对于ELF，通过生成拓扑路径则可以将(3,-1)与(3,-3)临界点之间的关系清晰地表现出来。

也有其他类型的拓扑路径，比如(3,+1)→(3,-1)，(3,+3) →(3,+1)







# Multiwfn中的操作

寻找临界点通常使用牛顿法。给出一个初猜点，通过反复迭代，就能找到与之最邻近的临界点。但牛顿法不一定每次都成功，有可能一直不收敛，也可能迭代过程中碰到Hessian矩阵为奇矩阵的情况，或者收敛到已找到的临界点位置，此时就要尝试从下一个初猜点开始了。初猜点与期望的临界点位置越近越容易成功收敛到相应的临界点。



## 电子密度

电子密度函数的结构很简单，一般都是在原子核处像一个山峰耸立，向着四周呈指数降低，典型体系的各种临界点位置都能大致猜出来，正如上面已经提到的。寻找(3,-3)点的时候初猜点都选在原子核位置。寻找(3,-1)点的时候，初猜点都选在两个原子或者两个已找到的(3,-3)点连线的中点，在这个过程中也可能顺便找到(3,+1)和(3,+3)点。另外也常常将三个原子或四个原子的几何中心作为初猜，这分别适合进一步寻找尚未找到的(3,+1)和(3,-3)点。假设利用这几种初猜方式还是没找到一些期望的临界点，但通过经验可以估计出期望的点出现的大致空间范围，那么就应当在这个空间范围内设定一大堆初猜点来尝试寻找那个临界点。

### 一般情况

- 使用Multiwfn加载fchk文件后：

  ```
  2  //拓扑分析功能
  2  //以所有原子核作为初猜点，目的是寻找所有核临界点
  3  //以每一对距离不很远的原子核连线中点作为初猜点，主要用来寻找键临界点
  8  //生成键径
  0  //观看结果
  ```

  - 此时文本界面会输出所有临界点和键径的信息，最后提示你Fine, Poincare-Hopf relationship is satisfied，这是所有临界点都已找到的必要非充分条件。凭借化学直觉或者如果这个条件没满足，临界点没找全，需要再用选项`4`（三个原子中心作为初猜）、选项`5`（四个原子中心作为初猜）或选项`6`（在某个位置附近随机设一大堆点）来进一步找临界点了。
  - 图形界面中：
    - 可以选择显示哪种CP，是否显示CP的标签，是否显示原子等。
    - 紫色的球是(3,-3)，与原子核位置基本一致。桔黄色是键临界点，黄色是环临界点。棕色的线是键径。

### 进一步寻找

有些临界点比较特殊，在默认的设定下，用选项2~5都找不到临界点，需要人为调整一下参数寻找其他临界点的方法：

- 重原子和氢连线上的键临界点找不到：在参数设定界面中将Set scale factor for stepsize一项设低，建议设为0.5，然后再重新找临界点。

- 由于初猜位置不合适：初猜点越接近临界点，就越有可能收敛到临界点。对极个别体系，选项2~5的方式设定的初猜点可能都不合适，故而会漏掉某些临界点，此时建议用选项6的方式设定初猜点。选项6会定义一个球心，然后让指定数目（通常设几百乃至上千）的初猜点随机分布在球体中来寻找临界点，只要能让初猜点随机分布的范围能够包含或者与潜在的临界点位置比较近，通常就能将那些临界点找出来。选项6的子选项1~6以不同方式定义这个球体的中心：

  - `10`：定义球体半径
  - `11`：设定将有多少个初猜点随机分布在球体中，
  - `0`：开始执行搜索。
  - `-1`，则用户不必设定球心，球心会自动依次定义在每个原子核上，也就是说，每个原子附近都会分布一堆初猜点来搜索临界点。
  - `-2`，则球心会自动依次定义在指定的原子核上，而非所有原子核上。

  选项6这种搜索方式对于电子密度临界点搜索用得机会不多，它最适合搜索ELF的临界点，因为ELF比电子密度临界点明显多得多，分布更复杂。

### 分析、编辑结果

- `7 Show real space function values at specific CP or all CPs `并且输入临界点的编号：可以获知这个临界点的一切信息，包括Multiwfn支持的各种实空间函数的数值（如电子密度、拉普拉斯值、动能密度、势能密度等）和电子密度的梯度以及Hessian矩阵，输出信息例如：

  ```
  CP Position:   -1.54802279321209    1.64407933432874   -0.36311758584834
  CP type: (3,-1)
  Density of all electrons:  0.3333962073E+00
  Density of Alpha electrons:  0.1666981037E+00
  Density of Beta electrons:  0.1666981037E+00
  Spin density of electrons:  0.0000000000E+00
  Lagrangian kinetic energy G(r):  0.1055976596E+00
  Hamiltonian kinetic energy K(r):  0.3702940096E+00
  Potential energy density V(r): -0.4758916692E+00
  Energy density: -0.3702940096E+00
  Laplacian of electron density: -0.1058785400E+01
  Electron localization function (ELF):  0.9499848594E+00
  Localized orbital locator (LOL):  0.8133846890E+00
  ...略
  ```

  Multiwfn还可以将临界点上的各种函数分解为各个轨道的贡献（可以是分子轨道、定域化轨道等）

- `-9`：计算临界点间、原子间的距离、角度。
- `-4`：导入导出已找到的临界点、删除或人为地增加临界点。
- `-5`：显示拓扑路径的详细信息（路径轨迹的坐标、路径长度等）并进行编辑和导入、导出，还能绘制各种实空间函数沿着键径上的变化图







## ELF

对于ELF、LOL和电子密度拉普拉斯函数，寻找对应原子内核处的临界点（对应高度定域的1s轨道电子）还是用原子核位置作为初猜。但是对于价层的ELF临界点，由于其分布较难预料，而且数目众多，最好的办法就是直接在每个原子附近都设一大堆初猜点来寻找各个临界点。不过，由于ELF临界点太多而且分布太复杂，想找全所有临界点绝非易事，所以，只要看到化学意义显著的临界点（所有的(3,-3)，以及部分(3,-1)）都已经找到了，临界点的搜索就可以停掉了。除了牛顿法，还有一种基于立方格点的临界点搜索方法，可以通过Multiwfn的盆分析实现，见《使用Multiwfn做电子密度、ELF、静电势、密度差等函数的盆分析》（http://sobereva.com/179），此方法虽然可以保证把(3,-3)搜索全，但定位精度低（精度取决于格点间距）。







# AIM盆分析

加载.fch文件后的总体步骤：

```
17 //盆分析
1  //生成盆并寻找吸引子
1  //用电子密度划分盆
2  //中等质量格点
7  //用混合格点积分AIM盆
2  //对边界进行精确修正
1  //积分电子密度，得到AIM电荷
4 //计算DI和LI
```

## 生成盆

以HCN为例：

1. `17`：盆分析

2. `1`：生成盆并寻找吸引子

   - 如果内存中已经有格点数据可以直接用，如果没有按下一步选择一个是空间函数

3. `1`：让Multiwfn计算电子密度格点数据，用来得到它的盆和吸引子

4. `2`：中等质量格点，也就是格点间距为0.1Bohr<a id="生成"></a>

   - 计算结束后有可能会出现：在某些情况下，在系统之外的区域，一些人为的或物理上无意义的吸引物被放置。这些吸引子具有非常低的功能值，因此被称为”无关紧要“的吸引子，相比之下，其他吸引子可以被称为“重要”吸引子。不重要吸引子的存在是因为在相应的区域内函数值很小，因此函数的行为不是很确定，即使是很小的函数值波动或微不足道的数值扰动都足以产生新的吸引子。当检测到的时候，会提示你处理它们：
     - `1`：什么都不做，不删除这些吸引子
     - `2`：删除这些吸引子，并且相应的格点设置为未赋值的格点
     - `3`：删除这些吸引子，同时分配相应的格点到最近的重要的吸引子（推荐）
   - 吸引子的坐标以及吸引子位置上的函数值：
     - 吸引子编号=盆编号，但是不等同于原子编号

   ```
   	Attractor       X,Y,Z coordinate (Angstrom)                Value
         1   -0.02645886   -0.02645886   -1.52058663          0.33959944
         2    0.02645886    0.02645886   -0.51514986         49.48609717
         3   -0.02645886   -0.02645886    0.64904009         76.55832377
   ```

## 观看盆和吸引子

选`0`来可视化刚找出来的吸引子和生成的盆。

- 紫色的文字对应吸引子的标号。
- 每个吸引子用绿色小球表示（位于原子核处的吸引子得取消选择show molecule选项才能看到）
- 界面右下角是盆列表，一个盆对应一个吸引子，盆的编号和吸引子编号是一致的，选择哪个盆就会显示出哪个盆。位于盆边界的格点通过绿球显示，使得盆的轮廓被勾勒出来。
- 选show basin interior让盆内部也显示
- 盆只显示处于电子密度0.001 a.u.等值面内部区域的部分：在图形界面上方选择Set basin drawing method→rho>0.001 region only

盆列表中的Unas和Boun：

- 这两类格点一般没有什么物理意义，对分析结果影响甚微，通常出现在离体系较远的地方，在上一步计算结束的时候也会有输出这些点的数量，如果是0，可视化的时候什么也不会出现

```
The number of unassigned grids:           0
The number of grids travelled to box boundary:           0
```

- "Unas"（意指Unassigned）是产生盆过程中由于某些数值算法原因没有成功被指认所属吸引子的格点
- "Boun"（意指travelled to box boundary）是指产生盆的过程中按照梯度最大方向移动但是最终移动到格点数据范围边界的点。
- 如果为了节省计算时间，没有让格点数据范围囊括整个分子而是只囊括了局部区域，那么可以得到只位于局部区域的盆，与此同时"Boun"类型的点会大量出现，依然无视它即可。

## 积分盆

### 使用均匀格点

这种积分方式可以用于任何函数：

1. 在生成盆之后，选择`2 Integrate real space functions in the basins`做盆积分

2. `1`：积电子密度：

   - 前面已经生成过电子密度格点数据，可以选择`0 The values of the grid data stored in memory`

3. 输出的每个盆的积分值还有盆的体积：

   - 盆体积对于当前体系没什么意义，因为三个盆的总和就是整个格点数据空间范围，故格点数据空间范围取得越大盆的体积就越大。

   ```
   #Basin        Integral(a.u.)      Volume(a.u.^3)
         1          0.7356142812        441.70000000
         2          5.3511710147        566.31900000
         3          7.9020060745        830.25600000
   Sum of above values:         13.98879137
   ```

   - 可以通过`Sum of above values`看积分精度，一般这样不会很理想，因为电子密度在重原子的原子核附近衰减速度较快，用均匀格点对这部分没法积分得很准。

### 使用混合格点积分（更精确）

只能积分AIM盆：

1. 在生成盆之后，选择`7`：混合格点进行积分

2. `1`：原子中心+均匀格点，忽略边界修正（<a href="#精度">并不精确</a>）。

3. `1`：电子密度

4. 输出盆中的电子布居数、盆体积、密度＞0.001的体积、分子的范德华体积

   ```
   Total result:
     #Basin        Integral(a.u.)      Vol(Bohr^3)    Vol(rho>0.001)
         1          0.7356461193         441.700          34.884
         2          5.3552270393         566.319         102.832
         3          7.9086504198         830.256         134.228
   Sum of above integrals:         13.99952358
   Sum of basin volumes (rho>0.001):     271.944 Bohr^3
   ```

   - 还输出了归一化因子、每个原子的AIM电荷，以及原子体积
     - 因为数值积分有误差，根据总电子数重新校正盆布居数（乘以归一化因子）得到AIM电荷
     - Volume等同于上面的Vol(rho>0.001)，代表的是盆中电子密度大于0.001的体积，按照Bader对范德华表面的定义，这相当于分子范德华表面内原子所占的体积，是有确切物理意义的，可认为是原子的尺寸。

   ```
   Normalization factor of the integral of electron density is    0.999966
   The atomic charges after normalization and atomic volumes:
        1 (C )    Charge:    0.644591     Volume:   102.832 Bohr^3
        2 (N )    Charge:   -0.908920     Volume:   134.228 Bohr^3
        3 (H )    Charge:    0.264329     Volume:    34.884 Bohr^3
   ```

### 提升精度

<a id="精度"></a>实际上这样原子盆的积分值并非很精确，对应的AIM电荷也不是非常精确。为了得到更准确的积分结果，还得对盆边界进一步修正，因此第二部中可以选择（精度有所提升，但会更耗时得多）：

- `2`：原子中心+均匀格点，精确优化边界
- `3`：

- 这三种模式的精度、耗时、内存消耗量：

  ```
  Accuracy: 2>=3>>1     Time spent: 2>3>>1     Memory requirement: 3>2=1
  ```

果想进一步提升精度，可以在生成盆的时候<a href="#生成">用更好的格点</a>，比如High quality grid，乃至Lunatic quality grid。然而，对于大体系，High quality grid已经很耗时、很占内存了。

## 分析定域化指数(LI)和离域化指数(DI)

- 选择功能`4`，Multiwfn就会输出盆之间的DI矩阵和盆内的LI值：

  ```
  ************ Total delocalization index matrix ************
              1             2             3
      1    0.97290584    0.90037924    0.07252660
      2    0.90037924    3.49303265    2.59265341
      3    0.07252660    2.59265341    2.66518001
  
  Total localization index:
      1:  0.259     2:  3.496     3:  6.658
  ```

- 还同时输出了行和列序号对应于原子序号的DI矩阵和LI值。

  ```
   ************** Total delocalization index matrix (atom index) **************
  ```

各个含义：

- 键级：DI就是一种共价键级的衡量标准，随着键的极性的增强DI值一般会降低。
  - 比如DI(2,3)=2.593，表明2号盆（C的AIM原子空间）和3号盆（N的AIM原子空间）之间平均来说共享了2.593个电子，这和HCN中C与N的形式键级3.0挺接近。

- DI矩阵的对角元是相应的列（或行）的矩阵元的加和，对于闭壳层体系，DI矩阵的对角元便是原子价。
  - 此体系N原子的原子价是2.66。
- LI与原子布居数的差值就是从原子盆中离域到别处去的电子数
  - 1号盆（H的AIM原子空间）的定域化指数为0.259，说明平均有0.259个电子定域在这个盆内，这个数值远小于此盆内电子布居数，表明在HCN体系内，电子很容易从H的AIM空间中离域出去，外界的电子也容易离域进来，换句话说，盆内外的电子容易相互交换。

